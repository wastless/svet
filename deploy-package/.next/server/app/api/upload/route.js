"use strict";(()=>{var e={};e.id=413,e.ids=[413],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{e.exports=require("querystring")},19185:e=>{e.exports=require("dgram")},21820:e=>{e.exports=require("os")},21994:e=>{e.exports=require("domain")},27910:e=>{e.exports=require("stream")},28354:e=>{e.exports=require("util")},29021:e=>{e.exports=require("fs")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},41204:e=>{e.exports=require("string_decoder")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},55591:e=>{e.exports=require("https")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{e.exports=require("timers")},79428:e=>{e.exports=require("buffer")},79551:e=>{e.exports=require("url")},79646:e=>{e.exports=require("child_process")},81630:e=>{e.exports=require("http")},87454:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>b,routeModule:()=>x,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>q});var o={};t.r(o),t.d(o,{POST:()=>f});var a=t(96559),s=t(48088),i=t(37719),n=t(32190),d=t(82162),p=t(33873),u=t.n(p),c=t(8516);async function f(e){try{let r,t,o=await e.formData(),a=o.get("file"),s=o.get("giftId"),i=o.get("fileType");if(!a)return n.NextResponse.json({error:"No file provided"},{status:400});if(!s)return n.NextResponse.json({error:"Gift ID is required"},{status:400});let p=Buffer.from(await a.arrayBuffer()),f=Date.now(),x=u().extname(a.name),l=u().basename(a.name,x),q=`${l}_${f}${x}`;switch(i){case"hint":t=`hint-image${x}`,r=void 0;break;case"memory":t=`memory-photo${x}`,r=void 0;break;default:t=q,r="blocks"}if(!c._.YANDEX_ACCESS_KEY_ID||!c._.YANDEX_SECRET_ACCESS_KEY||!c._.YANDEX_BUCKET_NAME)return n.NextResponse.json({error:"Yandex Object Storage is not configured"},{status:500});try{let e=await (0,d.TU)(p,t,s,r);return console.log(`Файл ${t} успешно загружен в Yandex Object Storage: ${e}`),n.NextResponse.json({url:e,fileName:t,originalName:a.name,size:a.size,type:a.type})}catch(e){return console.error(`Ошибка загрузки в Yandex Object Storage:`,e),n.NextResponse.json({error:"Failed to upload file to Yandex Object Storage"},{status:500})}}catch(e){return console.error("Error uploading file:",e),n.NextResponse.json({error:"Failed to upload file"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"C:\\repositories\\lesya.svet\\src\\app\\api\\upload\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:q,serverHooks:m}=x;function b(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:q})}},94735:e=>{e.exports=require("events")},98089:(e,r,t)=>{t.r(r),t.d(r,{"00ea83477a13a459fdf08fd3e6f65958e8233576fd":()=>o.xK,"40217cf8d08e1947972106ddde22ddf43c2bb0ed41":()=>o.z2,"4066d672de5ab4d947483099099b587b8f65bca2a7":()=>o.q2,"406d0e21608895f9fa266a4fd00f7cd6825119033a":()=>o.EB,"4078492ea5b92d5fdfeed6743137880623145f68ac":()=>o.xZ,"60104488d5035fa6645db34d4720bc5db5ca51ebe3":()=>o.jJ,"6065a8450153a035b58e5f7c83c86ece5b2a923f4b":()=>o.ql,"783346ae271af48396c519dd51d41fc3ec639e216f":()=>o.qr});var o=t(82162)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[447,724,267,580,41],()=>t(87454));module.exports=o})();