(()=>{var e={};e.id=169,e.ids=[169],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},93059:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>m,workAsyncStorage:()=>u,workUnitAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{POST:()=>c});var i=r(96559),o=r(48088),a=r(37719),l=r(32190);async function n(e,t){try{let r=`https://music.yandex.ru/album/${e}/track/${t}`,s=await fetch(r,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8","Accept-Language":"ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3",Referer:"https://music.yandex.ru/","Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"same-origin","Cache-Control":"max-age=0"}});if(!s.ok){if(403===s.status)throw Error("Яндекс блокирует прямые запросы к страницам. Для решения проблемы нужно настроить прокси-сервер или использовать обходное решение. Пока введите данные вручную.");throw Error(`Ошибка HTTP! Статус: ${s.status}`)}let i=await s.text(),o=/<title[^>]*>([^<]+)<\/title>/i.exec(i),a=/<meta property="og:image" content="([^"]+)"/i.exec(i),l=/<meta property="og:title" content="([^"]+)"/i.exec(i),n=/<meta name="description" content="([^"]+)"/i.exec(i),c=/<h1[^>]*class="[^"]*track[^"]*"[^>]*>([^<]+)<\/h1>/i.exec(i),p=/<a[^>]*class="[^"]*artist[^"]*"[^>]*>([^<]+)<\/a>/i.exec(i);if(console.log("Debug info:",{title:o?.[1],ogTitle:l?.[1],description:n?.[1],h1:c?.[1],artistLink:p?.[1]}),!o?.[1])throw Error("Could not extract track title");let u="Неизвестный исполнитель",d="Неизвестный трек";if(l?.[1]){let e=l[1];if(console.log("Parsing og:title:",e),e.includes(" — ")){let t=e.split(" — ");t.length>=2&&t[0]&&t[1]&&(u=t[0].trim(),d=t[1].trim(),console.log("Parsed from og:title with —:",{artist:u,trackName:d}))}else if(e.includes(", ")){let t=e.split(", ");t.length>=2&&t[0]&&t[1]&&(d=t[0].trim(),u=t[1].trim(),console.log("Parsed from og:title with ,:",{artist:u,trackName:d}))}}if("Неизвестный исполнитель"===u||"Неизвестный трек"===d){let e=o[1];console.log("Parsing title:",e);let t=e.replace(/\s+слушать онлайн на Яндекс Музыке?$/i,"").replace(/\s+—\s+Яндекс Музыка$/i,"").replace(/\s+\|\s+Яндекс Музыка$/i,"").trim();console.log("Cleaned title:",t);let r=/^(.+?)\s+([А-ЯA-Z][А-ЯA-Z\s]+)$/.exec(t);if(r?.[1]&&r[2])d=r[1].trim(),u=r[2].trim(),console.log("Parsed with title-artist pattern:",{artist:u,trackName:d});else if(t.includes(" — ")){let e=t.split(" — ");e.length>=2&&e[0]&&e[1]&&(d=e[0].trim(),u=e[1].trim(),console.log("Parsed from title with —:",{artist:u,trackName:d}))}else if(t.includes(" - ")){let e=t.split(" - ");e.length>=2&&e[0]&&e[1]&&(d=e[0].trim(),u=e[1].trim(),console.log("Parsed from title with -:",{artist:u,trackName:d}))}else if(t.includes(", ")){let e=t.split(", ");e.length>=2&&e[0]&&e[1]&&(d=e[0].trim(),u=e[1].trim(),console.log("Parsed from title with ,:",{artist:u,trackName:d}))}}if(("Неизвестный исполнитель"===u||"Неизвестный трек"===d)&&n?.[1]){let e=n[1];console.log("Parsing description:",e);let t=/Слушайте\s+[«"']([^«"']+)[«"']\s+от\s+(.+?)(?:\s+в|$)/i.exec(e);if(t?.[1]&&t[2])d=t[1].trim(),u=t[2].trim(),console.log("Parsed from description pattern 1:",{artist:u,trackName:d});else{let t=/^([^—]+)\s+—\s+(.+?)(?:\s+слушать|$)/i.exec(e);t?.[1]&&t[2]&&(u=t[1].trim(),d=t[2].trim(),console.log("Parsed from description pattern 2:",{artist:u,trackName:d}))}}let m=/<script type="application\/ld\+json"[^>]*>([^<]+)<\/script>/i.exec(i);if(m?.[1]&&("Неизвестный исполнитель"===u||"Неизвестный трек"===d))try{let e=JSON.parse(m[1]);console.log("Found JSON-LD:",e),e?.name&&(d=e.name),e?.byArtist?.name&&(u=e.byArtist.name),console.log("Parsed from JSON-LD:",{artist:u,trackName:d})}catch(e){console.log("Failed to parse JSON-LD:",e)}u=u.replace(/\s+слушать.*$/i,"").trim(),d=d.replace(/\s+слушать.*$/i,"").trim(),"Неизвестный исполнитель"===u&&"Неизвестный трек"===d&&(d=o[1].replace(/\s+слушать онлайн на Яндекс Музыке?$/i,"").replace(/\s+—\s+Яндекс Музыка$/i,"").trim(),console.log("Using fallback:",{trackName:d})),console.log("Final result:",{artist:u,trackName:d});let g="/images/default-album-cover.jpg";return a?.[1]&&(g=(g=a[1]).replace(/\/\d+x\d+$/,"/400x400")),{artist:u,trackName:d,coverUrl:g}}catch(e){return console.error("Error fetching track metadata:",e),null}}async function c(e){try{let{url:t}=await e.json();if(!t||"string"!=typeof t)return l.NextResponse.json({error:"URL is required"},{status:400});let r=function(e){let t=/\/album\/(\d+)\/track\/(\d+)/.exec(e);return t?.[1]&&t[2]?{albumId:t[1],trackId:t[2]}:null}(t);if(!r)return l.NextResponse.json({error:"Неверный формат URL Яндекс.Музыки"},{status:400});let s=await n(r.albumId,r.trackId);if(!s)return l.NextResponse.json({error:"Не удалось получить метаданные трека"},{status:500});return l.NextResponse.json({success:!0,metadata:s})}catch(t){console.error("Error in yandex-music metadata API:",t);let e=t instanceof Error?t.message:"Внутренняя ошибка сервера";return l.NextResponse.json({error:e},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/yandex-music/metadata/route",pathname:"/api/yandex-music/metadata",filename:"route",bundlePath:"app/api/yandex-music/metadata/route"},resolvedPagePath:"C:\\repositories\\lesya.svet\\src\\app\\api\\yandex-music\\metadata\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:u,workUnitAsyncStorage:d,serverHooks:m}=p;function g(){return(0,a.patchFetch)({workAsyncStorage:u,workUnitAsyncStorage:d})}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(93059));module.exports=s})();