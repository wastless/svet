exports.id=41,exports.ids=[41],exports.modules={8516:(e,t,r)=>{"use strict";r.d(t,{_:()=>a});var n=r(32871),o=r(45697);let a=(0,n.w)({server:{AUTH_SECRET:o.z.string(),DATABASE_URL:o.z.string().url(),NODE_ENV:o.z.enum(["development","test","production"]).default("development"),YANDEX_ACCESS_KEY_ID:o.z.string().optional(),YANDEX_SECRET_ACCESS_KEY:o.z.string().optional(),YANDEX_BUCKET_NAME:o.z.string().optional()},client:{},runtimeEnv:{AUTH_SECRET:process.env.AUTH_SECRET,DATABASE_URL:process.env.DATABASE_URL,NODE_ENV:"production",YANDEX_ACCESS_KEY_ID:process.env.YANDEX_ACCESS_KEY_ID,YANDEX_SECRET_ACCESS_KEY:process.env.YANDEX_SECRET_ACCESS_KEY,YANDEX_BUCKET_NAME:process.env.YANDEX_BUCKET_NAME},skipValidation:!!process.env.SKIP_ENV_VALIDATION,emptyStringAsUndefined:!0})},67218:(e,t,r)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n.registerServerReference}});let n=r(12907)},74722:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{normalizeAppPath:function(){return a},normalizeRscURL:function(){return i}});let n=r(85531),o=r(35499);function a(e){return(0,n.ensureLeadingSlash)(e.split("/").reduce((e,t,r,n)=>!t||(0,o.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:e+"/"+t,""))}function i(e){return e.replace(/\.rsc($|\?)/,"$1")}},78335:()=>{},79130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{decryptActionBoundArgs:function(){return y},encryptActionBoundArgs:function(){return p}}),r(34822);let n=r(12907),o=r(52513),a=r(77855),i=r(82602),l=r(63033),c=r(84971),s=function(e){return e&&e.__esModule?e:{default:e}}(r(61120)),u=new TextEncoder,d=new TextDecoder;async function f(e,t){let r=await (0,i.getActionEncryptionKey)();if(void 0===r)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let n=atob(t),o=n.slice(0,16),a=n.slice(16),l=d.decode(await (0,i.decrypt)(r,(0,i.stringToUint8Array)(o),(0,i.stringToUint8Array)(a)));if(!l.startsWith(e))throw Object.defineProperty(Error("Invalid Server Action payload: failed to decrypt."),"__NEXT_ERROR_CODE",{value:"E191",enumerable:!1,configurable:!0});return l.slice(e.length)}async function g(e,t){let r=await (0,i.getActionEncryptionKey)();if(void 0===r)throw Object.defineProperty(Error("Missing encryption key for Server Action. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E65",enumerable:!1,configurable:!0});let n=new Uint8Array(16);l.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(n));let o=(0,i.arrayBufferToString)(n.buffer),a=await (0,i.encrypt)(r,n,u.encode(e+t));return btoa(o+(0,i.arrayBufferToString)(a))}let p=s.default.cache(async function e(t,...r){let{clientModules:o}=(0,i.getClientReferenceManifestForRsc)(),s=Error();Error.captureStackTrace(s,e);let u=!1,d=l.workUnitAsyncStorage.getStore(),f=(null==d?void 0:d.type)==="prerender"?(0,c.createHangingInputAbortSignal)(d):void 0,p=await (0,a.streamToString)((0,n.renderToReadableStream)(r,o,{signal:f,onError(e){(null==f||!f.aborted)&&(u||(u=!0,s.message=e instanceof Error?e.message:String(e)))}}),f);if(u)throw s;if(!d)return g(t,p);let y=(0,l.getPrerenderResumeDataCache)(d),E=(0,l.getRenderResumeDataCache)(d),b=t+p,_=(null==y?void 0:y.encryptedBoundArgs.get(b))??(null==E?void 0:E.encryptedBoundArgs.get(b));if(_)return _;let A="prerender"===d.type?d.cacheSignal:void 0;null==A||A.beginRead();let S=await g(t,p);return null==A||A.endRead(),null==y||y.encryptedBoundArgs.set(b,S),S});async function y(e,t){let r,n=await t,a=l.workUnitAsyncStorage.getStore();if(a){let t="prerender"===a.type?a.cacheSignal:void 0,o=(0,l.getPrerenderResumeDataCache)(a),i=(0,l.getRenderResumeDataCache)(a);(r=(null==o?void 0:o.decryptedBoundArgs.get(n))??(null==i?void 0:i.decryptedBoundArgs.get(n)))||(null==t||t.beginRead(),r=await f(e,n),null==t||t.endRead(),null==o||o.decryptedBoundArgs.set(n,r))}else r=await f(e,n);let{edgeRscModuleMapping:c,rscModuleMapping:s}=(0,i.getClientReferenceManifestForRsc)();return await (0,o.createFromReadableStream)(new ReadableStream({start(e){e.enqueue(u.encode(r)),(null==a?void 0:a.type)==="prerender"?a.renderSignal.aborted?e.close():a.renderSignal.addEventListener("abort",()=>e.close(),{once:!0}):e.close()}}),{serverConsumerManifest:{moduleLoading:null,moduleMap:s,serverModuleMap:(0,i.getServerModuleMap)()}})}},82162:(e,t,r)=>{"use strict";let n;r.d(t,{EB:()=>S,T1:()=>v,TU:()=>d,jJ:()=>y,q2:()=>g,ql:()=>E,qr:()=>u,xK:()=>c,xZ:()=>_,yk:()=>A,yz:()=>b,z2:()=>f,zM:()=>p});var o=r(67218);r(79130);var a=r(33873),i=r.n(a),l=r(8516);let c=async function(){try{return n=new(await r.e(709).then(r.t.bind(r,80709,23))).default({auth:{accessKeyId:process.env.YANDEX_ACCESS_KEY_ID||"",secretAccessKey:process.env.YANDEX_SECRET_ACCESS_KEY||""},Bucket:process.env.YANDEX_BUCKET_NAME||"",debug:!1})}catch(e){throw console.error("Ошибка инициализации Yandex Object Storage:",e),e}};var s=(0,o.A)(c,"00ea83477a13a459fdf08fd3e6f65958e8233576fd",null);let u=async function(e,t,r,o){try{let a;n||await s();let l=function(e){let t=i().extname(e),r=i().basename(e,t),n=(e=>{let t={а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"h",ц:"ts",ч:"ch",ш:"sh",щ:"sch",ъ:"",ы:"y",ь:"",э:"e",ю:"yu",я:"ya",А:"A",Б:"B",В:"V",Г:"G",Д:"D",Е:"E",Ё:"YO",Ж:"ZH",З:"Z",И:"I",Й:"Y",К:"K",Л:"L",М:"M",Н:"N",О:"O",П:"P",Р:"R",С:"S",Т:"T",У:"U",Ф:"F",Х:"H",Ц:"TS",Ч:"CH",Ш:"SH",Щ:"SCH",Ъ:"",Ы:"Y",Ь:"",Э:"E",Ю:"YU",Я:"YA"," ":"_","-":"_","–":"_","—":"_"};return e.split("").map(e=>t[e]||e).join("")})(r).replace(/[^a-zA-Z0-9_]/g,"_").replace(/_+/g,"_"),o=Date.now();return`${n}_${o}${t}`}(t),c=`${r}_${"blocks"===o?"block_":""}${l}`;switch(console.log(`Загрузка файла в Yandex Object Storage: ${c}`),i().extname(t).toLowerCase()){case".jpg":case".jpeg":a="image/jpeg";break;case".png":a="image/png";break;case".gif":a="image/gif";break;case".mp3":a="audio/mpeg";break;case".mp4":a="video/mp4";break;case".webm":a="video/webm";break;case".ogg":a="audio/ogg";break;case".wav":a="audio/wav"}let u=await n.Upload({buffer:e,name:c,ContentType:a},"");if(!u||"boolean"==typeof u||!("Location"in u))throw Error("Не удалось загрузить файл в Yandex Object Storage");return u.Location}catch(e){throw console.error(`Ошибка загрузки файла ${t} в Yandex Object Storage:`,e),e}};var d=(0,o.A)(u,"783346ae271af48396c519dd51d41fc3ec639e216f",null);let f=async function(e){try{n||await s();let t=new URL(e),r=t.pathname.startsWith("/")?t.pathname.substring(1):t.pathname,o=await n.Remove(r);return!0===o}catch(e){return console.error(`Ошибка удаления файла из Yandex Object Storage:`,e),!1}};(0,o.A)(f,"40217cf8d08e1947972106ddde22ddf43c2bb0ed41",null);let g=async function(e){try{n||(console.log(`Инициализация S3 для удаления файлов подарка ${e}...`),await s()),console.log(`Удаление файлов подарка ${e} из Yandex Object Storage...`),console.log("Получаем список всех файлов из бакета...");let t=await n.GetList("");console.log("Ответ от API:",t);let r=[];if(!t||"object"!=typeof t)return console.log("Нет файлов для удаления или ошибка получения списка файлов"),0;if("Contents"in t&&Array.isArray(t.Contents))console.log(`Получен ответ в формате AWS SDK v2 с ${t.Contents.length} файлами`),r=t.Contents.map(e=>{let t=l._.YANDEX_BUCKET_NAME||"";return{Key:e.Key,Location:`https://${t}.storage.yandexcloud.net/${e.Key}`}});else{if(!Array.isArray(t))return console.log("Неизвестный формат ответа от GetList:",t),0;console.log(`Получен массив с ${t.length} файлами`),r=t}console.log(`Обработано ${r.length} файлов из бакета`),console.log("Все файлы в бакете:"),r.forEach((e,t)=>{console.log(`${t+1}. ${e.Key}`)});let o=r.filter(t=>{let r=t.Key,n=r.startsWith(`${e}_`)||r.startsWith(`/${e}_`)||r.includes(`/${e}_`);return n&&console.log(`Найден файл подарка: ${r}`),n});if(console.log(`Найдено ${o.length} файлов для удаления`),0===o.length)return console.log(`Не найдено файлов для подарка ${e}`),0;let a=0;for(let e of o){let t=e.Key;try{console.log(`Удаляем файл: ${t}`);let r=await n.Remove(t);if(console.log(`Результат удаления файла ${t}: ${r}`),!0===r)a++,console.log(`Успешно удален файл: ${t}`);else{console.error(`Не удалось удалить файл: ${t}, результат: ${r}`),console.log(`Пробуем альтернативный метод удаления для ${t}...`);try{if(e.Location){let t=e.Location,r=new URL(t),o=r.pathname.startsWith("/")?r.pathname.substring(1):r.pathname;console.log(`Пытаемся удалить по пути: ${o}`);let i=await n.Remove(o);!0===i?(a++,console.log(`Успешно удален файл (альтернативный метод): ${o}`)):console.error(`Не удалось удалить файл (альтернативный метод): ${o}`)}}catch(e){console.error(`Ошибка при альтернативном удалении: ${e}`)}}}catch(e){console.error(`Ошибка удаления файла ${t}:`,e)}}return console.log(`Удалено ${a} файлов из ${o.length}`),a}catch(t){return console.error(`Ошибка удаления файлов подарка ${e}:`,t),0}};var p=(0,o.A)(g,"4066d672de5ab4d947483099099b587b8f65bca2a7",null);let y=async function(e,t=!1){try{n||await s();let r=await n.GetList();if(!r||!Array.isArray(r))return[];let o=t?`${e}_block_`:`${e}_`,a=t?"":"block_";return r.filter(e=>{if(!e||"object"!=typeof e||!("Key"in e)||!("Location"in e))return!1;let r=e.Key;return t?r.startsWith(o):r.startsWith(o)&&!r.includes(`_${a}`)}).map(e=>e.Location).filter(Boolean)}catch(e){return console.error(`Ошибка получения списка файлов из Yandex Object Storage:`,e),[]}};(0,o.A)(y,"60104488d5035fa6645db34d4720bc5db5ca51ebe3",null);let E=async function(e,t){try{n||await s();let r=JSON.stringify(t,null,2),o=Buffer.from(r,"utf-8"),a=`${e}_content.json`;console.log(`Загрузка контента в Yandex Object Storage: ${a}`);let i=await n.Upload({buffer:o,name:a,ContentType:"application/json"},"");if(!i||"boolean"==typeof i||!("Location"in i))throw Error("Не удалось загрузить контент в Yandex Object Storage");return i.Location}catch(t){throw console.error(`Ошибка загрузки контента для подарка ${e} в Yandex Object Storage:`,t),t}};var b=(0,o.A)(E,"6065a8450153a035b58e5f7c83c86ece5b2a923f4b",null);let _=async function(e){try{n||await s();let t=`${e}_content.json`;console.log(`Загрузка контента из Yandex Object Storage: ${t}`);let r=await n.GetObject(t);if(!r||"object"!=typeof r||!("Body"in r))return null;let o=r.Body.toString("utf-8");return JSON.parse(o)}catch(t){return console.error(`Ошибка загрузки контента для подарка ${e} из Yandex Object Storage:`,t),null}};var A=(0,o.A)(_,"4078492ea5b92d5fdfeed6743137880623145f68ac",null);let S=async function(e){try{n||await s();let t=`${e}_content.json`,r=await n.FileExists(t);return!0===r}catch(t){return console.error(`Ошибка проверки существования контента для подарка ${e} в Yandex Object Storage:`,t),!1}};var v=(0,o.A)(S,"406d0e21608895f9fa266a4fd00f7cd6825119033a",null)},82602:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{arrayBufferToString:function(){return l},decrypt:function(){return u},encrypt:function(){return s},getActionEncryptionKey:function(){return y},getClientReferenceManifestForRsc:function(){return p},getServerModuleMap:function(){return g},setReferenceManifestsSingleton:function(){return f},stringToUint8Array:function(){return c}});let o=r(71617),a=r(74722),i=r(29294);function l(e){let t=new Uint8Array(e),r=t.byteLength;if(r<65535)return String.fromCharCode.apply(null,t);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(t[e]);return n}function c(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}function s(e,t,r){return crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,r)}function u(e,t,r){return crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r)}let d=Symbol.for("next.server.action-manifests");function f({page:e,clientReferenceManifest:t,serverActionsManifest:r,serverModuleMap:n}){var o;let i=null==(o=globalThis[d])?void 0:o.clientReferenceManifestsPerPage;globalThis[d]={clientReferenceManifestsPerPage:{...i,[(0,a.normalizeAppPath)(e)]:t},serverActionsManifest:r,serverModuleMap:n}}function g(){let e=globalThis[d];if(!e)throw Object.defineProperty(new o.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});return e.serverModuleMap}function p(){let e=globalThis[d];if(!e)throw Object.defineProperty(new o.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let{clientReferenceManifestsPerPage:t}=e,r=i.workAsyncStorage.getStore();if(!r){var n=t;let e=Object.values(n),r={clientModules:{},edgeRscModuleMapping:{},rscModuleMapping:{}};for(let t of e)r.clientModules={...r.clientModules,...t.clientModules},r.edgeRscModuleMapping={...r.edgeRscModuleMapping,...t.edgeRscModuleMapping},r.rscModuleMapping={...r.rscModuleMapping,...t.rscModuleMapping};return r}let a=t[r.route];if(!a)throw Object.defineProperty(new o.InvariantError(`Missing Client Reference Manifest for ${r.route}.`),"__NEXT_ERROR_CODE",{value:"E570",enumerable:!1,configurable:!0});return a}async function y(){if(n)return n;let e=globalThis[d];if(!e)throw Object.defineProperty(new o.InvariantError("Missing manifest for Server Actions."),"__NEXT_ERROR_CODE",{value:"E606",enumerable:!1,configurable:!0});let t=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||e.serverActionsManifest.encryptionKey;if(void 0===t)throw Object.defineProperty(new o.InvariantError("Missing encryption key for Server Actions"),"__NEXT_ERROR_CODE",{value:"E571",enumerable:!1,configurable:!0});return n=await crypto.subtle.importKey("raw",c(atob(t)),"AES-GCM",!0,["encrypt","decrypt"])}},85531:(e,t)=>{"use strict";function r(e){return e.startsWith("/")?e:"/"+e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureLeadingSlash",{enumerable:!0,get:function(){return r}})},96487:()=>{}};