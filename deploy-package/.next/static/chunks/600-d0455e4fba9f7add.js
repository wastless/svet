"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{3330:(e,t,n)=>{n.d(t,{HJ:()=>w,Kv:()=>f,RX:()=>u,Zj:()=>h,sw:()=>d,xj:()=>v});var r=n(2960),i=n(6715),o=n(5041),a=n(4258),l=n(2385),s=n(2115);let c={GIFTS:"gifts",GIFT:e=>["gift",e],GIFT_CONTENT:e=>["gift-content",e]};function h(){return(0,r.I)({queryKey:[c.GIFTS],queryFn:async()=>{let e=Date.now(),t=await fetch("/api/gifts?_t=".concat(e));if(!t.ok)throw Error("Ошибка загрузки подарков");return t.json()},staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0})}function u(e){return(0,r.I)({queryKey:c.GIFT_CONTENT(e),queryFn:async()=>{let t=Date.now(),n=await fetch("/api/gift-content/".concat(e,"?_t=").concat(t));if(!n.ok)throw Error("Ошибка загрузки контента подарка ".concat(e));if(n.redirected){let t=await fetch(n.url);if(!t.ok)throw Error("Ошибка загрузки контента подарка ".concat(e," из облачного хранилища"));return t.json()}return n.json()},enabled:!!e,staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0})}function d(e){var t;let n=(0,r.I)({queryKey:c.GIFT(e),queryFn:async()=>{let t=Date.now(),n=await fetch("/api/gifts/".concat(e,"?_t=").concat(t));if(!n.ok)throw Error("Ошибка загрузки подарка ".concat(e));return n.json()},enabled:!!e,staleTime:0,gcTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0}),i=u(e),o=(0,a.Q)(),h=n.isLoading||i.isLoading||o.isLoading,d=n.isError||i.isError||o.isError,f=n.error||i.error||o.error,v=(0,s.useMemo)(()=>{var e,t;return h||d?null:{gift:n.data,content:i.data,isAuthenticated:null==(e=o.data)?void 0:e.isAuthenticated,memoryPhoto:null==(t=n.data)?void 0:t.memoryPhoto}},[h,d,n.data,i.data,null==(t=o.data)?void 0:t.isAuthenticated]),w=(0,s.useRef)(!1);return{data:v,isLoading:h,isError:d,error:f,refetch:(0,s.useCallback)(async()=>{w.current||(console.log("\uD83D\uDD04 Invalidating cache for gift ".concat(e)),(0,l.Mb)(e),w.current=!0),await Promise.all([n.refetch(),i.refetch()]),setTimeout(()=>{w.current=!1},500)},[e,n,i])}}function f(){let e=(0,i.jE)();return(0,o.n)({mutationFn:async e=>{let t=await fetch("/api/gifts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Ошибка при создании подарка");return t.json()},onSuccess:()=>{e.invalidateQueries({queryKey:[c.GIFTS]}),(0,l.Mb)()}})}function v(e){let t=(0,i.jE)();return(0,o.n)({mutationFn:async t=>{if(!e)throw Error("ID подарка не указан");let n=await fetch("/api/gifts/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw Error((await n.json()).error||"Ошибка при обновлении подарка");return n.json()},onSuccess:n=>{e&&(t.setQueryData(c.GIFT(e),n),t.invalidateQueries({queryKey:[c.GIFTS]}),t.invalidateQueries({queryKey:c.GIFT_CONTENT(e)}),(0,l.Mb)(e))}})}function w(){let e=(0,i.jE)();return(0,o.n)({mutationFn:async e=>{if(!(await fetch("/api/gifts/".concat(e),{method:"DELETE"})).ok)throw Error("Ошибка при удалении подарка");return e},onSuccess:t=>{e.invalidateQueries({queryKey:[c.GIFTS]}),e.removeQueries({queryKey:c.GIFT(t)}),e.removeQueries({queryKey:c.GIFT_CONTENT(t)}),(0,l.Mb)(t)}})}},3855:(e,t,n)=>{var r=n(2385);console.log("\uD83D\uDE80 Initializing unified fetch patch early..."),(0,r.HT)()},4629:(e,t,n)=>{n.d(t,{E$:()=>a,HQ:()=>v,IJ:()=>l,fl:()=>i,kt:()=>s,lQ:()=>h,ne:()=>f,nn:()=>u,th:()=>d,ud:()=>o,v:()=>c});var r=n(5155);function i(e){let{className:t="",size:n=16}=e;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:n,height:n,className:t,children:[(0,r.jsx)("g",{clipPath:"url(#arrow-right_a)",children:(0,r.jsx)("path",{fill:"currentColor",d:"M8.757 13.6565L14.414 7.99951L8.757 2.34351L7.343 3.75751L10.586 6.99951H2V8.99951H10.586L7.343 12.2425L8.757 13.6565Z"})}),(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:"arrow-right_a",children:(0,r.jsx)("path",{d:"M0 0h16v16H0z"})})})]})}function o(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:n,height:n,className:t,fill:"currentColor",children:(0,r.jsx)("path",{d:"M8 5.5V12h11v-.75C14 9.5 9.5 5.5 9.5 5.5zm0 13V12h11v.75c-5 1.75-9.5 5.75-9.5 5.75z",clipRule:"evenodd",fillRule:"evenodd"})})}function a(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:n,height:n,className:t,fill:"currentColor",children:(0,r.jsx)("path",{d:"M11 5.5H7v13h4zm6 0h-4v13h4z",clipRule:"evenodd",fillRule:"evenodd"})})}function l(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:n,height:n,className:t,fill:"currentColor",children:(0,r.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"})})}function s(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("div",{style:{width:n,height:n},className:"border-current animate-spin rounded-full border-b-2 ".concat(t)})}function c(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:n,height:n,className:t,fill:"currentColor",children:(0,r.jsx)("path",{d:"M12.5 3H12l-.299.398V3.4l-.003.003-.018.024-.088.108a10 10 0 0 1-.375.422c-.339.36-.848.855-1.52 1.381C8.348 6.392 6.37 7.553 3.82 8.017L3 8.164v7.67l.821.149c2.55.463 4.528 1.624 5.875 2.679q.812.633 1.52 1.381.241.257.464.53l.018.024.002.002.001.001.299.4h4.5V3zm.174 2.326A13 13 0 0 0 12.97 5h1.53v14h-1.53q-.145-.166-.296-.326a16 16 0 0 0-1.745-1.587C9.546 16.006 7.554 14.805 5 14.19V9.81c2.554-.615 4.546-1.815 5.929-2.898a15.6 15.6 0 0 0 1.745-1.586M19.5 6v12h2V6z",clipRule:"evenodd"})})}function h(e){let{className:t="",size:n=20}=e;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:n,height:n,className:t,fill:"currentColor",children:[(0,r.jsx)("path",{d:"m16.5 17.44 3.355 2.826 1.289-1.53-4.644-3.91v-.012l-2-1.674L2.145 2.736.856 4.266l4.133 3.48a12 12 0 0 1-1.168.27L3 8.166v7.669l.821.149c2.55.463 4.528 1.624 5.875 2.679q.812.633 1.52 1.381.241.257.464.53l.018.024.002.002.001.001L12 21h4.5zm-2-1.684V19h-1.53q-.145-.166-.296-.326a16 16 0 0 0-1.745-1.587C9.546 16.006 7.554 14.805 5 14.19V9.81c.63-.151 1.225-.339 1.785-.551zM16.5 4v6.902l-2-1.675V5h-1.53a14 14 0 0 1-.296.326c-.322.342-.768.78-1.335 1.255L9.777 5.273q.766-.607 1.44-1.317.24-.257.463-.53l.018-.024.002-.003h.001L12 3h4.5z",clipRule:"evenodd",fillRule:"evenodd"}),(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{children:(0,r.jsx)("path",{d:"M0 0h24v24H0z"})})})]})}function u(e){let{className:t="",size:n=48}=e;return(0,r.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:n,height:n,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}function d(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:n,height:n,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}function f(e){let{className:t="",size:n=20}=e;return(0,r.jsx)("svg",{className:t,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",width:n,height:n,children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function v(e){let{className:t=""}=e;return(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"72",height:"34",fill:"none",viewBox:"0 0 64 30",className:t,children:[(0,r.jsx)("g",{clipPath:"url(#a)",children:(0,r.jsx)("path",{fill:"#F90000",d:"M60.8 8.66c.455.455.82.82 1.184 1.229 2.368 2.594 2.641 5.87.865 8.874-.865 1.456-2.05 2.593-3.37 3.594-3.052 2.276-6.468 3.777-10.111 4.733-11.568 3.049-23.228 3.185-34.933.865-3.097-.592-6.103-1.548-8.927-3.095-1.548-.864-2.96-1.866-4.007-3.322C-.276 19.172-.458 16.67.863 14.03c.865-1.775 2.232-3.14 3.78-4.369 2.733-2.184 5.739-3.822 8.972-5.096C25.32-.213 37.39-1.124 49.732 1.288c3.37.637 6.559 1.775 9.474 3.686.592.41 1.184.82 1.73 1.32 1.093.956 1.048 1.274-.136 2.366M49.823 3.7v-.182c-.728-.136-1.412-.318-2.14-.455-9.701-1.638-19.266-1.138-28.693 1.73-4.1 1.228-8.062 2.912-11.569 5.414-1.32.956-2.641 2.003-3.689 3.231-2.414 2.867-2.14 5.78.82 8.1 1.275 1.002 2.778 1.775 4.281 2.458 3.234 1.41 6.65 2.093 10.111 2.594 8.29 1.137 16.578 1.046 24.822-.365 4.418-.773 8.699-2.047 12.616-4.368 1.594-.956 3.097-2.048 4.19-3.55 1.867-2.502 1.685-5.142-.547-7.326-.683-.683-1.457-1.274-2.277-1.82-3.826-2.503-8.061-3.55-12.57-3.459-.957 0-1.959.091-2.915.137-.592 0-1.093-.228-1.139-.865-.045-.546.365-.91.911-.955.957-.137 1.913-.364 2.87-.41 1.64-.045 3.279.046 4.918.091"})}),(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:"a",children:(0,r.jsx)("path",{fill:"#fff",d:"M0 0h64v29.553H0z"})})})]})}n(2115)},7200:(e,t,n)=>{n.d(t,{A:()=>d,O:()=>h});var r=n(5155);n(3855);var i=n(6320),o=n(2115),a=n(4258),l=n(6715),s=n(2385);let c=(0,o.createContext)({isAuthenticated:!1,isLoading:!0,user:null,invalidateSession:()=>{}});function h(e){let{children:t}=e;return(0,r.jsx)(i.CP,{refetchInterval:0,refetchOnWindowFocus:!1,refetchWhenOffline:!1,children:(0,r.jsx)(u,{children:t})})}function u(e){let{children:t}=e,n=(0,l.jE)(),{data:i,isLoading:o}=(0,a.Q)();return(0,r.jsx)(c.Provider,{value:{isAuthenticated:!!(null==i?void 0:i.isAuthenticated),isLoading:o,user:null==i?void 0:i.user,invalidateSession:()=>{(0,s.GB)(),n.invalidateQueries({queryKey:[a.e]})}},children:t})}function d(){return(0,o.useContext)(c)}}}]);