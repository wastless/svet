"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4546],{285:(e,t,a)=>{a.d(t,{b:()=>l});var o=a(5155),c=a(2115),n=a(9708);let r=(0,a(6694).tv)({slots:{root:["btn-adaptive"]}}),l=c.forwardRef((e,t)=>{let{children:a,asChild:l,className:s,...i}=e;c.useId();let u=l?n.DX:"button",h=r();return(0,o.jsx)(u,{ref:t,className:h.root({className:s}),...i,children:a})});l.displayName="ButtonRoot"},501:(e,t,a)=>{a.d(t,{cn:()=>r,w:()=>n}),a(4391);var o=a(2596),c=a(9688);let n={extend:{classGroups:{"font-size":[{text:["title-h1","md-title-h1","sm-title-h1","title-h2","title-h3","title-h4","sm-title-h4","title-h5","paragraph-xl","paragraph-lg","paragraph-md","paragraph-sm","paragraph-xs","label-xl","label-lg","label-md","label-sm","label-xs","marker-lg","marker-md","marker-sm"]}]}}},r=((0,c.zu)(n),o.A)},2385:(e,t,a)=>{a.d(t,{GB:()=>g,HT:()=>u,Mb:()=>f,RN:()=>d});let o=globalThis.fetch,c={},n={},r={SESSION:18e5,GIFT:6e5,GIFT_CONTENT:18e5,DEFAULT:3e5};function l(e){return e?e.includes("/api/auth/session")?r.SESSION:e.includes("/api/gifts/")?r.GIFT:e.includes("/api/gift-content/")?r.GIFT_CONTENT:r.DEFAULT:r.DEFAULT}let s=0;function i(e){return e.split("|")[0]||""}function u(){globalThis.fetch.__patchedUnified||(f(),function(){try{let e=localStorage.getItem("api_request_cache");if(e){let t=JSON.parse(e);for(let[e,a]of Object.entries(t))if(a&&"object"==typeof a&&"data"in a&&"timestamp"in a&&"status"in a&&"statusText"in a&&"headers"in a){let t=i(e),o=l(t);Date.now()-a.timestamp<o&&(c[e]=a)}console.log("\uD83D\uDD04 Loaded ".concat(Object.keys(c).length," entries from localStorage"))}}catch(e){console.error("Error loading cache from localStorage:",e)}}(),globalThis.fetch=async function(e,t){let a,r=e instanceof Request?e.url:String(e),i=(null==t?void 0:t.method)||"GET",u=++s,d=(a=null,(null==t?void 0:t.headers)&&(t.headers instanceof Headers?a=t.headers.get("Authorization"):"object"==typeof t.headers&&(a=t.headers.Authorization||null)),a?"".concat(r,"|").concat(a):r);if(!("GET"===i&&r.includes("/api/auth/session")))return o(e,t);if(console.log("\uD83D\uDD0D[".concat(u,"] Intercepting API request: ").concat(i," ").concat(r)),c[d]){let e=c[d],t=l(r);if(Date.now()-e.timestamp<t)return console.log("\uD83D\uDFE2[".concat(u,"] Returning cached data for:"),r),new Response(JSON.stringify(e.data),{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)});console.log("\uD83D\uDFE0[".concat(u,"] Cache expired for:"),r)}if(n[d]){console.log("\uD83D\uDFE3[".concat(u,"] Reusing pending request for:"),r);try{if(await n[d],c[d]){let e=c[d];return console.log("\uD83D\uDFE3[".concat(u,"] Using cached result from pending request for:"),r),new Response(JSON.stringify(e.data),{status:e.status,statusText:e.statusText,headers:new Headers(e.headers)})}}catch(e){console.error("⚠️[".concat(u,"] Error waiting for pending request:"),e)}console.log("⚠️[".concat(u,"] Cache missing after pending request, retrying:"),r)}console.log("\uD83D\uDD35[".concat(u,"] Making real request to:"),r);try{n[d]=o(e,t);let a=await n[d];if(a.ok)try{let e=a.clone(),t=await e.json(),o={};e.headers.forEach((e,t)=>{o[t]=e}),c[d]={data:t,timestamp:Date.now(),status:e.status,statusText:e.statusText,headers:o},h(),console.log("\uD83D\uDCBE[".concat(u,"] Data cached for:"),r)}catch(e){console.error("⚠️[".concat(u,"] Error caching response:"),e)}return a}finally{delete n[d]}},globalThis.fetch.__patchedUnified=!0,console.log("✅ Unified fetch patch applied"),window.addEventListener("beforeunload",()=>h()))}function h(){try{let e=Object.keys(c),t={...c};if(e.length>50){let a=e.sort((e,t)=>{var a,o;let n=(null==(a=c[e])?void 0:a.timestamp)||0;return((null==(o=c[t])?void 0:o.timestamp)||0)-n}).slice(0,20);for(let e of(t={},a))c[e]&&(t[e]=c[e])}localStorage.setItem("api_request_cache",JSON.stringify(t)),console.log("\uD83D\uDCBE Saved ".concat(Object.keys(t).length," entries to localStorage"))}catch(e){console.error("Error saving cache to localStorage:",e)}}function d(){Object.keys(c).forEach(e=>delete c[e]),localStorage.removeItem("api_request_cache"),console.log("\uD83D\uDDD1️ Entire cache invalidated")}function g(){Object.keys(c).filter(e=>i(e).includes("/api/auth/session")).forEach(e=>delete c[e]),h(),console.log("\uD83D\uDDD1️ Session cache invalidated")}function f(e){if(e){Object.keys(c).filter(t=>{let a=i(t);return a.includes("/api/gifts/".concat(e))||a.includes("/api/gift-content/".concat(e))}).forEach(e=>delete c[e]),console.log("\uD83D\uDDD1️ Invalidated cache for gift ".concat(e));try{let t=localStorage.getItem("api_request_cache");if(t){let a=JSON.parse(t),o=!1;Object.keys(a).forEach(t=>{let c=i(t);(c.includes("/api/gifts/".concat(e))||c.includes("/api/gift-content/".concat(e)))&&(delete a[t],o=!0)}),o&&(localStorage.setItem("api_request_cache",JSON.stringify(a)),console.log("\uD83D\uDDD1️ LocalStorage cache cleared for gift ".concat(e)))}}catch(e){console.error("Error clearing localStorage cache:",e)}}else{Object.keys(c).filter(e=>{let t=i(e);return t.includes("/api/gifts")||t.includes("/api/gift-content")}).forEach(e=>delete c[e]),console.log("\uD83D\uDDD1️ Gift cache invalidated");try{let e=localStorage.getItem("api_request_cache");if(e){let t=JSON.parse(e),a=!1;Object.keys(t).forEach(e=>{let o=i(e);(o.includes("/api/gifts")||o.includes("/api/gift-content"))&&(delete t[e],a=!0)}),a&&(localStorage.setItem("api_request_cache",JSON.stringify(t)),console.log("\uD83D\uDDD1️ LocalStorage cache cleared for all gifts"))}}catch(e){console.error("Error clearing localStorage cache:",e)}}h()}},4258:(e,t,a)=>{a.d(t,{Q:()=>s,e:()=>n});var o=a(2960),c=a(2115);let n="auth-session",r=()=>{try{let e=localStorage.getItem("auth_session_cache");if(e){let t=JSON.parse(e);if(new Date(t.expiresAt||0)>new Date)return t.data}}catch(e){console.error("Ошибка при получении кешированной сессии:",e)}return null},l=e=>{try{let t=new Date(Date.now()+18e5);localStorage.setItem("auth_session_cache",JSON.stringify({data:e,expiresAt:t.toISOString()}))}catch(e){console.error("Ошибка при сохранении кешированной сессии:",e)}};function s(){let e=(0,c.useCallback)(async()=>{console.log("\uD83D\uDD11 Fetching session data");let e=await fetch("/api/auth/session"),t=await e.json(),a={user:(null==t?void 0:t.user)||null,isAuthenticated:!!(null==t?void 0:t.user),expires:(null==t?void 0:t.expires)||null};return l(a),a},[]);return(0,o.I)({queryKey:[n],queryFn:e,initialData:r,staleTime:18e5,gcTime:36e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})}},6694:(e,t,a)=>{a.d(t,{tv:()=>n});var o=a(6733),c=a(501);let n=(0,o.N1)({twMergeConfig:c.w})}}]);